var _=class{constructor(){this._listeners=new Map}on(e,t){let n=this._listeners.get(e);return n||(n=new Set,this._listeners.set(e,n)),n.add(t),()=>{n.delete(t),n.size===0&&this._listeners.delete(e)}}once(e,t){let n=this.on(e,i=>{n(),t(i)});return n}emit(e,t){let n=this._listeners.get(e);if(n)for(let i of[...n])i(t)}off(e){e?this._listeners.delete(e):this._listeners.clear()}hasListeners(e){let t=this._listeners.get(e);return t!==void 0&&t.size>0}listenerCount(e){return this._listeners.get(e)?.size??0}destroy(){this._listeners.clear()}};var E=class r{constructor(){this._data=new Map}setData(e,t){this._data.set(e,t)}getData(e){return this._data.get(e)}hasType(e){return this._data.has(e)}get types(){return[...this._data.keys()]}clear(){this._data.clear()}clone(){let e=new r;for(let[t,n]of this._data)e.setData(t,n);return e}};var b=class extends _{constructor(){super(...arguments);this._session=null;this._idCounter=0}get session(){return this._session}isDragging(){return this._session!==null&&this._session.phase==="dragging"}getActiveElement(){return this._session?.element??null}getCurrentDropZone(){return this._session?.dropZone??null}startDrag(t,n,i){this._session&&this.cancelDrag();let o=new E;if(i)for(let[s,a]of Object.entries(i))o.setData(s,a);return this._session={id:`drag-${++this._idCounter}`,element:t,origin:{x:n.x,y:n.y},current:{x:n.x,y:n.y},delta:{x:0,y:0},data:o,dropZone:null,phase:"dragging"},this.emit("dragstart",this._session),this._session}updatePosition(t){!this._session||this._session.phase!=="dragging"||(this._session.current.x=t.x,this._session.current.y=t.y,this._session.delta.x=t.x-this._session.origin.x,this._session.delta.y=t.y-this._session.origin.y,this.emit("dragmove",this._session))}setDropTarget(t){if(!this._session)return;let n=this._session.dropZone;n!==t&&(n&&(this._session.dropZone=null,this.emit("dropzoneleave",this._session)),t&&(this._session.dropZone=t,this.emit("dropzoneenter",this._session)))}endDrag(){if(!this._session)return null;let t=this._session;return t.phase="dropping",t.dropZone&&this.emit("drop",t),this.emit("dragend",t),this._session=null,t}cancelDrag(){if(!this._session)return null;let t=this._session;return t.phase="cancelled",t.dropZone=null,this.emit("dragend",t),this._session=null,t}subscribe(t,n){return this.on(t,n)}reset(){this._session&&this.cancelDrag()}destroy(){this.reset(),super.destroy()}};var D=class{constructor(e){this._rafId=null;this._pending=null;this._process=()=>{if(this._rafId=null,this._pending!==null){let e=this._pending;this._pending=null,this._callback(e)}};this._callback=e}queue(e){this._pending=e,this._rafId===null&&(this._rafId=requestAnimationFrame(this._process))}cancel(){this._rafId!==null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this._pending=null}flush(){if(this._pending!==null){let e=this._pending;this.cancel(),this._callback(e)}}get isPending(){return this._rafId!==null}destroy(){this.cancel()}};function K(r){let e=null,t=null,n=(...i)=>{t=i,e===null&&(e=requestAnimationFrame(()=>{e=null,t!==null&&(r(...t),t=null)}))};return n.cancel=()=>{e!==null&&(cancelAnimationFrame(e),e=null),t=null},n.flush=()=>{e!==null&&(cancelAnimationFrame(e),e=null),t!==null&&(r(...t),t=null)},n}var x=class{constructor(e,t,n=10,i=100){this._pool=[];this._factory=e,this._reset=t,this._maxSize=i;for(let o=0;o<n;o++)this._pool.push(e())}acquire(){return this._pool.pop()??this._factory()}release(e){this._pool.length<this._maxSize&&(this._reset(e),this._pool.push(e))}clear(){this._pool.length=0}get size(){return this._pool.length}},v=new x(()=>({x:0,y:0}),r=>{r.x=0,r.y=0}),$=new x(()=>({x:0,y:0,width:0,height:0}),r=>{r.x=0,r.y=0,r.width=0,r.height=0});function m(r,e){let t=v.acquire();return t.x=r,t.y=e,t}var y=class extends _{constructor(t){super();this._attached=!1;this._activePointerId=null;this._activeElement=null;this._startPosition=null;this._isDragging=!1;this._delayTimer=null;this._onPointerDown=t=>{if(!t.isPrimary||t.button!==0||this._activePointerId!==null)return;let n=this._findDraggable(t);if(!n||this._options.handleSelector&&!this._findHandle(t,n))return;t.preventDefault(),this._activePointerId=t.pointerId,this._activeElement=n,this._startPosition=m(t.clientX,t.clientY),this._isDragging=!1,t.target.setPointerCapture(t.pointerId);let i=this._getEventTarget();i.addEventListener("pointermove",this._onPointerMove,{passive:!0}),i.addEventListener("pointerup",this._onPointerUp),i.addEventListener("pointercancel",this._onPointerCancel);let o=this._options.delay??0;o>0?this._delayTimer=window.setTimeout(()=>{this._delayTimer=null,this._startDrag(t)},o):(this._options.distance??0)===0&&this._startDrag(t)};this._onPointerMove=t=>{t.pointerId===this._activePointerId&&(this._options.throttle===!1?this._processMove(t):this._moveThrottle.queue(t))};this._processMove=t=>{if(!this._startPosition||!this._activeElement)return;let n=m(t.clientX,t.clientY);if(!this._isDragging){let i=this._options.distance??0;if(i>0){let o=n.x-this._startPosition.x,s=n.y-this._startPosition.y;if(Math.sqrt(o*o+s*s)<i){v.release(n);return}this._clearDelayTimer(),this._startDrag(t)}}if(this._isDragging){let i=m(n.x-this._startPosition.x,n.y-this._startPosition.y);this.emit("pointermove",{position:n,delta:i,pointerId:t.pointerId,originalEvent:t})}else v.release(n)};this._onPointerUp=t=>{t.pointerId===this._activePointerId&&(this._moveThrottle.flush(),this._isDragging&&this.emit("pointerup",{position:m(t.clientX,t.clientY),pointerId:t.pointerId,originalEvent:t}),this._cleanup())};this._onPointerCancel=t=>{t.pointerId===this._activePointerId&&(this._moveThrottle.cancel(),this._isDragging&&this.emit("pointercancel",{position:m(t.clientX,t.clientY),pointerId:t.pointerId,originalEvent:t}),this._cleanup())};this._container=t.container,this._options=t,this._moveThrottle=new D(n=>this._processMove(n))}attach(){if(this._attached)return;this._getEventTarget().addEventListener("pointerdown",this._onPointerDown,{passive:!1}),this._attached=!0}detach(){if(!this._attached)return;this._getEventTarget().removeEventListener("pointerdown",this._onPointerDown),this._cleanup(),this._attached=!1}get isActive(){return this._activePointerId!==null}get isDragging(){return this._isDragging}_getEventTarget(){return this._container instanceof ShadowRoot?this._container.host:this._container}_startDrag(t){this._isDragging||!this._activeElement||!this._startPosition||(this._isDragging=!0,this.emit("pointerdown",{element:this._activeElement,position:{x:this._startPosition.x,y:this._startPosition.y},pointerId:t.pointerId,originalEvent:t}))}_findDraggable(t){let n=t.target,i=t.composedPath();for(let o of i)if(o instanceof HTMLElement){if(o.matches(this._options.draggableSelector))return o;if(o===this._container||o===this._container.host)break}return n.closest?.(this._options.draggableSelector)}_findHandle(t,n){if(!this._options.handleSelector)return n;let o=t.target.closest?.(this._options.handleSelector);return o&&n.contains(o)?o:null}_clearDelayTimer(){this._delayTimer!==null&&(clearTimeout(this._delayTimer),this._delayTimer=null)}_cleanup(){this._clearDelayTimer(),this._moveThrottle.cancel(),this._startPosition&&(v.release(this._startPosition),this._startPosition=null);let t=this._getEventTarget();t.removeEventListener("pointermove",this._onPointerMove),t.removeEventListener("pointerup",this._onPointerUp),t.removeEventListener("pointercancel",this._onPointerCancel),this._activePointerId=null,this._activeElement=null,this._isDragging=!1}destroy(){this.detach(),this._moveThrottle.destroy(),super.destroy()}};var P=class{constructor(){this._cache=new WeakMap;this._dirty=new WeakSet;this._invalidateAll=!1}get(e){if(this._invalidateAll||this._dirty.has(e))return this._update(e);let t=this._cache.get(e);return t||this._update(e)}invalidate(e){this._dirty.add(e)}invalidateAll(){this._invalidateAll=!0}update(e){return this._update(e)}remove(e){this._cache.delete(e)}clearDirty(){this._invalidateAll=!1}_update(e){let t=e.getBoundingClientRect();return this._cache.set(e,t),this._dirty.delete(e),t}},h=new P;function C(r,e,t){return r>=t.left&&r<=t.right&&e>=t.top&&e<=t.bottom}function g(r){return{x:r.left+r.width/2,y:r.top+r.height/2}}var S=class{constructor(e){this._enabled=!1;this._listenerUnsubscribers=[];this._ghost=null;this._ghostOffset={x:0,y:0};this._onPointerDown=e=>{let{element:t,position:n}=e,i=this._getItemData(t)??this._extractDataAttributes(t),o=this._state.startDrag(t,n,i);this._createGhost(t,n),t.classList.add("snap-dragging"),this._options.ghostClass&&t.classList.add(this._options.ghostClass);let s={element:t,position:{x:n.x,y:n.y},data:o.data,cancel:()=>{this._state.cancelDrag(),this._cleanup(t)}};if(this._options.onDragStart?.(s)===!1){this._state.cancelDrag(),this._cleanup(t);return}h.invalidateAll()};this._onPointerMove=e=>{let t=this._state.session;if(!t)return;let{position:n}=e,i=this._getItemAxis(t.element)??this._options.axis??"both";i!=="both"&&(n=this._applyAxisConstraint(n,t.origin,i)),this._options.grid&&(n=this._applyGridSnap(n,this._options.grid)),this._state.updatePosition(n),this._updateGhost(n),this._updateDropZone(n),this._options.onDragMove?.({element:t.element,position:{x:t.current.x,y:t.current.y},delta:{x:t.delta.x,y:t.delta.y},dropZone:t.dropZone})};this._onPointerUp=e=>{if(!this._state.session)return;let n=this._state.endDrag();n&&(this._cleanup(n.element),n.dropZone&&this._options.onDrop?.({element:n.element,dropZone:n.dropZone,position:{x:n.current.x,y:n.current.y},data:n.data}),this._options.onDragEnd?.({element:n.element,position:{x:n.current.x,y:n.current.y},delta:{x:n.delta.x,y:n.delta.y},cancelled:!1}))};this._onPointerCancel=e=>{let t=this._state.session;if(!t)return;let n=t.element;this._state.cancelDrag(),this._cleanup(n),this._options.onDragEnd?.({element:n,position:e.position,delta:{x:0,y:0},cancelled:!0})};this._container=e.container,this._state=e.state,this._options=e.options,this._getDropZones=e.getDropZones,this._getItemData=e.getItemData,this._getItemAxis=e.getItemAxis,this._pointerSensor=new y({container:this._container,draggableSelector:this._options.draggableSelector??"[data-draggable]",handleSelector:this._options.handleSelector,delay:this._options.delay,distance:this._options.distance,throttle:this._options.throttle}),this._setupListeners()}enable(){this._enabled||(this._pointerSensor.attach(),this._enabled=!0)}disable(){this._enabled&&(this._pointerSensor.detach(),this._state.reset(),this._removeGhost(),this._enabled=!1)}get isEnabled(){return this._enabled}updateOptions(e){Object.assign(this._options,e)}_setupListeners(){this._listenerUnsubscribers.push(this._pointerSensor.on("pointerdown",this._onPointerDown),this._pointerSensor.on("pointermove",this._onPointerMove),this._pointerSensor.on("pointerup",this._onPointerUp),this._pointerSensor.on("pointercancel",this._onPointerCancel))}_applyAxisConstraint(e,t,n){return n==="x"?{x:e.x,y:t.y}:n==="y"?{x:t.x,y:e.y}:e}_applyGridSnap(e,t){return{x:Math.round(e.x/t.x)*t.x,y:Math.round(e.y/t.y)*t.y}}_updateDropZone(e){let t=this._getDropZones(),n=null;for(let o of t){let s=h.get(o);if(C(e.x,e.y,s)){n=o;break}}let i=this._state.session;i&&n!==i.dropZone&&(i.dropZone&&this._options.onDropZoneLeave?.({element:i.element,dropZone:i.dropZone}),this._state.setDropTarget(n),n&&this._options.onDropZoneEnter?.({element:i.element,dropZone:n,position:e}))}_createGhost(e,t){let n=e.getBoundingClientRect();this._ghostOffset={x:t.x-n.left,y:t.y-n.top},this._options.renderGhost?this._ghost=this._options.renderGhost(e):(this._ghost=e.cloneNode(!0),this._copyComputedStyles(e,this._ghost)),this._ghost.style.position="fixed",this._ghost.style.left="0",this._ghost.style.top="0",this._ghost.style.width=`${n.width}px`,this._ghost.style.height=`${n.height}px`,this._ghost.style.margin="0",this._ghost.style.pointerEvents="none",this._ghost.style.zIndex="9999",this._ghost.style.opacity="0.8",this._ghost.style.willChange="transform",this._ghost.classList.add("snap-ghost"),this._ghost.style.transform=`translate(${n.left}px, ${n.top}px)`,document.body.appendChild(this._ghost)}_copyComputedStyles(e,t){let n=window.getComputedStyle(e),i=["background","backgroundColor","backgroundImage","border","borderRadius","boxShadow","color","fontSize","fontWeight","fontFamily","textAlign","display","alignItems","justifyContent","flexDirection","flexWrap","padding","gap","margin","width","height","minWidth","minHeight","maxWidth","maxHeight","overflow","textOverflow","whiteSpace","lineHeight","letterSpacing","opacity","visibility","boxSizing"];for(let a of i){let l=n.getPropertyValue(a.replace(/([A-Z])/g,"-$1").toLowerCase());l&&t.style.setProperty(a.replace(/([A-Z])/g,"-$1").toLowerCase(),l)}let o=e.children,s=t.children;for(let a=0;a<o.length;a++)o[a]instanceof HTMLElement&&s[a]instanceof HTMLElement&&this._copyComputedStyles(o[a],s[a])}_updateGhost(e){if(!this._ghost)return;let t=e.x-this._ghostOffset.x,n=e.y-this._ghostOffset.y;this._ghost.style.transform=`translate(${t}px, ${n}px)`}_removeGhost(){this._ghost&&(this._ghost.remove(),this._ghost=null)}_cleanup(e){e.classList.remove("snap-dragging"),this._options.ghostClass&&e.classList.remove(this._options.ghostClass),this._removeGhost()}_extractDataAttributes(e){let t={};for(let i of e.attributes)if(i.name.startsWith("data-drag-")){let o=i.name.slice(10);t[o]=i.value}let n=e.dataset.draggable;return n&&n!==""&&(t.type=n),t}destroy(){this.disable();for(let e of this._listenerUnsubscribers)e();this._listenerUnsubscribers=[],this._pointerSensor.destroy()}};var H=class{constructor(e,t={}){this._isActive=!1;this._element=e,this._options=t}get element(){return this._element}get isActive(){return this._isActive}setOptions(e){Object.assign(this._options,e)}containsPoint(e,t){let n=h.get(this._element);return C(e,t,n)}accepts(e){let{accepts:t}=this._options;if(!t)return!0;if(typeof t=="function")return t(e);for(let i of t)if(e.hasType(i)||e.getData("type")===i)return!0;let n=this._element.dataset.accepts;if(n){let i=n.split(",").map(o=>o.trim());for(let o of i)if(e.hasType(o)||e.getData("type")===o)return!0}return!1}setActive(e){this._isActive!==e&&(this._isActive=e,e?this._element.classList.add("snap-drop-active"):this._element.classList.remove("snap-drop-active"))}getInsertionIndex(e,t,n,i){let o=Array.from(this._element.querySelectorAll(n)).filter(p=>p!==i);if(o.length===0)return 0;let s=h.get(o[0]),a=h.get(o[o.length-1]),l=Math.abs(a.top-s.top)>Math.abs(a.left-s.left);for(let p=0;p<o.length;p++){let u=h.get(o[p]),d=g(u);if(l){if(t<d.y)return p}else if(e<d.x)return p}return o.length}getClosestItem(e,t,n,i){let o=Array.from(this._element.querySelectorAll(n)).filter(c=>c!==i);if(o.length===0)return null;let s=null,a=1/0,l="after",p=h.get(o[0]),u=h.get(o[o.length-1]),d=Math.abs(u.top-p.top)>Math.abs(u.left-p.left);for(let c of o){let f=h.get(c),L=g(f),z=e-L.x,B=t-L.y,q=Math.sqrt(z*z+B*B);q<a&&(a=q,s=c,l=d?t<L.y?"before":"after":e<L.x?"before":"after")}return s?{element:s,position:l}:null}updateBounds(){h.update(this._element)}destroy(){this.setActive(!1),h.remove(this._element)}},M=class{constructor(){this._zones=new Map}register(e,t){let n=this._zones.get(e);return n?(t&&n.setOptions(t),n):(n=new H(e,t),this._zones.set(e,n),n)}unregister(e){let t=this._zones.get(e);t&&(t.destroy(),this._zones.delete(e))}get(e){return this._zones.get(e)}getElements(){return[...this._zones.keys()]}getAll(){return[...this._zones.values()]}findAtPoint(e,t){for(let n of this._zones.values())if(n.containsPoint(e,t))return n;return null}clear(){for(let e of this._zones.values())e.destroy();this._zones.clear()}updateAllBounds(){h.invalidateAll()}destroy(){this.clear()}};var X={draggableSelector:"[data-draggable]",dropZoneSelector:"[data-droppable]",axis:"both",autoRefresh:!1},I=class{constructor(e,t={}){this._imperativeDraggables=new Map;this._imperativeDropZones=new Map;this._plugins=[];this._behaviors=[];this._eventListeners=new Map;this._stateUnsubscribers=[];this._observer=null;this._refreshScheduled=!1;this._destroyed=!1;this._scrollHandler=null;this._resizeHandler=null;this._container=e,this._options={...X,...t},this._wrapCallbacks(),this._state=new b,this._dropZoneManager=new M,this._engine=new S({container:this._container,state:this._state,options:this._options,getDropZones:()=>this._getDropZones(),getItemData:n=>this._getItemData(n),getItemAxis:n=>this._getItemAxis(n)}),this._setupStateListeners(),this._scanDeclarativeElements(),this._options.autoRefresh&&this._setupAutoRefresh(),this._setupScrollResize(),this.enable()}get options(){return this._options}enable(){this._engine.enable()}disable(){this._engine.disable()}destroy(){this._destroyed=!0,this.disable();for(let e of this._stateUnsubscribers)e();this._stateUnsubscribers=[];for(let e of this._plugins)e.destroy();this._plugins=[];for(let e of this._behaviors)e.destroy();this._behaviors=[],this._engine.destroy(),this._state.destroy(),this._dropZoneManager.destroy(),this._observer?.disconnect(),this._observer=null,this._scrollHandler&&(window.removeEventListener("scroll",this._scrollHandler,!0),this._scrollHandler=null),this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null),this._imperativeDraggables.clear(),this._imperativeDropZones.clear()}refresh(){this._scanDeclarativeElements(),h.invalidateAll()}addDraggable(e,t){this._imperativeDraggables.set(e,t??{})}removeDraggable(e){this._imperativeDraggables.delete(e)}addDropZone(e,t){this._imperativeDropZones.set(e,t??{}),this._dropZoneManager.register(e,t)}removeDropZone(e){this._imperativeDropZones.delete(e),this._dropZoneManager.unregister(e)}isDragging(){return this._state.isDragging()}getActiveElement(){return this._state.getActiveElement()}use(e){return this._plugins.push(e),e.init(this),this}addBehavior(e){return this._behaviors.push(e),this}setOptions(e){Object.assign(this._options,e),this._engine.updateOptions(this._options)}on(e,t){return this._eventListeners.has(e)||this._eventListeners.set(e,new Set),this._eventListeners.get(e).add(t),()=>this.off(e,t)}off(e,t){this._eventListeners.get(e)?.delete(t)}_emit(e,t){let n=this._eventListeners.get(e);if(n)for(let i of n)i(t)}_wrapCallbacks(){let e={...this._options};this._options.onDragStart=t=>(this._emit("dragstart",t),e.onDragStart?.(t)),this._options.onDragMove=t=>{this._emit("dragmove",t),e.onDragMove?.(t)},this._options.onDragEnd=t=>{this._emit("dragend",t),e.onDragEnd?.(t)},this._options.onDrop=t=>{this._emit("drop",t),e.onDrop?.(t)},this._options.onDropZoneEnter=t=>{this._emit("dropzoneenter",t),e.onDropZoneEnter?.(t)},this._options.onDropZoneLeave=t=>{this._emit("dropzoneleave",t),e.onDropZoneLeave?.(t)}}_getDropZones(){let e=this._options.dropZoneSelector??"[data-droppable]",t=this._container instanceof ShadowRoot?this._container:this._container,n=Array.from(t.querySelectorAll(e)),i=[...this._imperativeDropZones.keys()];return[...new Set([...n,...i])]}_getItemData(e){return this._imperativeDraggables.get(e)?.data}_getItemAxis(e){let t=this._imperativeDraggables.get(e);if(t?.axis)return t.axis;let n=e.dataset.dragAxis;if(n==="x"||n==="y"||n==="both")return n}_scanDeclarativeElements(){let e=this._options.dropZoneSelector??"[data-droppable]",n=(this._container instanceof ShadowRoot?this._container:this._container).querySelectorAll(e);for(let i of n)this._imperativeDropZones.has(i)||this._dropZoneManager.register(i)}_setupStateListeners(){this._stateUnsubscribers.push(this._state.subscribe("dragstart",e=>{for(let t of this._behaviors)t.onDragStart?.(e)})),this._stateUnsubscribers.push(this._state.subscribe("dragmove",e=>{for(let t of this._behaviors)t.onDragMove?.(e)})),this._stateUnsubscribers.push(this._state.subscribe("dragend",e=>{for(let t of this._behaviors)t.onDragEnd?.(e)}))}_setupAutoRefresh(){this._observer=new MutationObserver(t=>{if(this._destroyed)return;let n=!1;for(let i of t)if(i.type==="childList"){n=!0;break}n&&!this._refreshScheduled&&(this._refreshScheduled=!0,requestAnimationFrame(()=>{this._destroyed||(this._refreshScheduled=!1,this.refresh())}))});let e=this._container instanceof ShadowRoot?this._container:this._container;this._observer.observe(e,{childList:!0,subtree:!0})}_setupScrollResize(){this._scrollHandler=()=>{this._state.isDragging()&&h.invalidateAll()},window.addEventListener("scroll",this._scrollHandler,!0),this._resizeHandler=()=>{h.invalidateAll()},window.addEventListener("resize",this._resizeHandler)}},Y=I;var G={animation:150,ghostClass:"snap-sortable-ghost",placeholderClass:"snap-sortable-placeholder"},w=class{constructor(e={}){this.name="sortable";this._snap=null;this._placeholder=null;this._draggedElement=null;this._originalIndex=-1;this._currentIndex=-1;this._container=null;this._items=[];this._unsubscribers=[];this._options={...G,...e}}init(e){this._snap=e;let t=e.options.onDragStart,n=e.options.onDragMove,i=e.options.onDrop,o=e.options.onDragEnd;e.setOptions({onDragStart:s=>(this._onDragStart(s.element),t?.(s)),onDragMove:s=>{this._onDragMove(s.position.x,s.position.y),n?.(s)},onDrop:s=>{let a={...s,insertionIndex:this._currentIndex,sourceContainer:this._container??void 0};i?.(a)},onDragEnd:s=>{this._onDragEnd(),o?.(s)}})}destroy(){this._cleanup();for(let e of this._unsubscribers)e();this._unsubscribers=[],this._snap=null}_onDragStart(e){if(this._draggedElement=e,this._container=e.parentElement,!this._container)return;let t=this._snap?.options.draggableSelector??"[data-draggable]";this._items=Array.from(this._container.querySelectorAll(`:scope > ${t}`)),this._originalIndex=this._items.indexOf(e),this._currentIndex=this._originalIndex,this._originalIndex!==-1&&(this._createPlaceholder(e),this._options.ghostClass&&e.classList.add(this._options.ghostClass))}_onDragMove(e,t){if(!this._placeholder||!this._container)return;let n=this._snap?.options.draggableSelector??"[data-draggable]",i=Array.from(this._container.querySelectorAll(`:scope > ${n}`)).filter(p=>p!==this._draggedElement&&p!==this._placeholder);if(i.length===0){this._currentIndex=0;return}let o=h.get(i[0]),s=h.get(i[i.length-1]),a=Math.abs(s.top-o.top)>Math.abs(s.left-o.left),l=i.length;for(let p=0;p<i.length;p++){let u=h.get(i[p]),d=g(u);if(a){if(t<d.y){l=p;break}}else if(e<d.x){l=p;break}}l!==this._currentIndex&&(this._currentIndex=l,this._movePlaceholder(l))}_onDragEnd(){this._cleanup()}_createPlaceholder(e){let t=e.getBoundingClientRect(),n=window.getComputedStyle(e);this._placeholder=document.createElement("div"),this._placeholder.className=this._options.placeholderClass??"",this._placeholder.style.cssText=`
      width: ${t.width}px;
      height: ${t.height}px;
      margin: ${n.margin};
      box-sizing: border-box;
    `,e.style.display="none",e.parentNode?.insertBefore(this._placeholder,e.nextSibling)}_movePlaceholder(e){if(!this._placeholder||!this._container)return;let t=this._snap?.options.draggableSelector??"[data-draggable]",n=Array.from(this._container.querySelectorAll(`:scope > ${t}`)).filter(i=>i!==this._draggedElement);if(this._placeholder.remove(),e>=n.length)this._container.appendChild(this._placeholder);else{let i=n[e];i===this._placeholder&&(i=n[e+1]),i?this._container.insertBefore(this._placeholder,i):this._container.appendChild(this._placeholder)}this._options.animation&&this._options.animation>0&&this._animateItems()}_animateItems(){if(!this._container)return;let e=this._snap?.options.draggableSelector??"[data-draggable]",t=Array.from(this._container.querySelectorAll(`:scope > ${e}`)).filter(i=>i!==this._draggedElement&&i!==this._placeholder),n=new Map;for(let i of t)n.set(i,i.getBoundingClientRect());this._container.offsetHeight;for(let i of t){let o=n.get(i),s=i.getBoundingClientRect();if(!o)continue;let a=o.left-s.left,l=o.top-s.top;(a!==0||l!==0)&&(i.style.transform=`translate(${a}px, ${l}px)`,i.style.transition="none",requestAnimationFrame(()=>{i.style.transition=`transform ${this._options.animation}ms ease`,i.style.transform=""}))}}_cleanup(){this._draggedElement&&this._placeholder&&this._placeholder.parentNode&&this._placeholder.parentNode.insertBefore(this._draggedElement,this._placeholder),this._draggedElement&&(this._draggedElement.style.display="",this._options.ghostClass&&this._draggedElement.classList.remove(this._options.ghostClass)),this._placeholder?.remove(),this._placeholder=null,this._draggedElement=null,this._container=null,this._items=[],this._originalIndex=-1,this._currentIndex=-1,h.invalidateAll()}getCurrentIndex(){return this._currentIndex}getOriginalIndex(){return this._originalIndex}};var j={containers:"[data-droppable]",items:"[data-draggable]",animation:150},Z=class{constructor(e={}){this.name="kanban";this._snap=null;this._sourceContainer=null;this._targetContainer=null;this._placeholder=null;this._originalIndex=-1;this._currentIndex=-1;this._options={...j,...e}}init(e){this._snap=e;let t=e.options.onDragStart,n=e.options.onDragMove,i=e.options.onDropZoneEnter,o=e.options.onDropZoneLeave,s=e.options.onDrop,a=e.options.onDragEnd;e.setOptions({onDragStart:l=>(this._onDragStart(l.element),t?.(l)),onDragMove:l=>{this._onDragMove(l.position),n?.(l)},onDropZoneEnter:l=>{this._onDropZoneEnter(l.dropZone),i?.(l)},onDropZoneLeave:l=>{this._onDropZoneLeave(l.dropZone),o?.(l)},onDrop:l=>{let p={...l,insertionIndex:this._currentIndex,sourceContainer:this._sourceContainer??void 0};s?.(p)},onDragEnd:l=>{this._onDragEnd(),a?.(l)}})}destroy(){this._cleanup(),this._snap=null}_onDragStart(e){if(this._sourceContainer=e.closest(this._options.containers),!this._sourceContainer)return;let t=Array.from(this._sourceContainer.querySelectorAll(this._options.items));this._originalIndex=t.indexOf(e),this._createPlaceholder(e)}_onDragMove(e){if(!this._targetContainer||!this._placeholder)return;let t=this._calculateInsertionIndex(this._targetContainer,e.x,e.y);t!==this._currentIndex&&(this._currentIndex=t,this._movePlaceholder(t))}_onDropZoneEnter(e){e.matches(this._options.containers)&&(this._targetContainer=e,this._targetContainer.classList.add("snap-kanban-target"),this._placeholder&&(this._targetContainer.appendChild(this._placeholder),this._currentIndex=this._getItemCount(this._targetContainer)))}_onDropZoneLeave(e){e===this._targetContainer&&(e.classList.remove("snap-kanban-target"),this._placeholder?.remove(),this._targetContainer=null,this._currentIndex=-1)}_onDragEnd(){this._cleanup()}_createPlaceholder(e){let t=e.getBoundingClientRect();this._placeholder=document.createElement("div"),this._placeholder.className="snap-kanban-placeholder",this._placeholder.style.cssText=`
      width: ${t.width}px;
      height: ${t.height}px;
      margin: 0;
      box-sizing: border-box;
      opacity: 0.5;
      border: 2px dashed #ccc;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.05);
    `,e.parentNode?.insertBefore(this._placeholder,e)}_movePlaceholder(e){if(!this._placeholder||!this._targetContainer)return;let t=this._snap?.getActiveElement(),n=Array.from(this._targetContainer.querySelectorAll(this._options.items)).filter(i=>i!==t&&i!==this._placeholder);if(this._placeholder.remove(),e>=n.length)this._targetContainer.appendChild(this._placeholder);else{let i=n[e];i?this._targetContainer.insertBefore(this._placeholder,i):this._targetContainer.appendChild(this._placeholder)}this._options.animation>0&&this._animateItems(this._targetContainer)}_calculateInsertionIndex(e,t,n){let i=this._snap?.getActiveElement(),o=Array.from(e.querySelectorAll(this._options.items)).filter(p=>p!==i&&p!==this._placeholder);if(o.length===0)return 0;let s=h.get(o[0]),a=h.get(o[o.length-1]),l=Math.abs(a.top-s.top)>Math.abs(a.left-s.left);for(let p=0;p<o.length;p++){let u=h.get(o[p]),d=g(u);if(l){if(n<d.y)return p}else if(t<d.x)return p}return o.length}_getItemCount(e){let t=this._snap?.getActiveElement();return Array.from(e.querySelectorAll(this._options.items)).filter(n=>n!==t&&n!==this._placeholder).length}_animateItems(e){let t=this._snap?.getActiveElement(),n=Array.from(e.querySelectorAll(this._options.items)).filter(o=>o!==t&&o!==this._placeholder),i=new Map;for(let o of n)i.set(o,o.getBoundingClientRect());e.offsetHeight;for(let o of n){let s=i.get(o),a=o.getBoundingClientRect();if(!s)continue;let l=s.left-a.left,p=s.top-a.top;(l!==0||p!==0)&&(o.style.transform=`translate(${l}px, ${p}px)`,o.style.transition="none",requestAnimationFrame(()=>{o.style.transition=`transform ${this._options.animation}ms ease`,o.style.transform=""}))}}_cleanup(){this._placeholder?.remove(),this._placeholder=null,this._sourceContainer?.classList.remove("snap-kanban-source"),this._targetContainer?.classList.remove("snap-kanban-target"),this._sourceContainer=null,this._targetContainer=null,this._originalIndex=-1,this._currentIndex=-1,h.invalidateAll()}getSourceContainer(){return this._sourceContainer}getTargetContainer(){return this._targetContainer}getCurrentIndex(){return this._currentIndex}};var T=class extends _{constructor(t){super();this._attached=!1;this._dragCount=0;this._currentDropZone=null;this._onDragEnter=t=>{if(!this._hasFiles(t))return;this._dragCount++;let n=this._findDropZone(t);n&&(t.preventDefault(),n!==this._currentDropZone&&(this._currentDropZone&&this.emit("dragleave",{position:{x:t.clientX,y:t.clientY},dropZone:this._currentDropZone,originalEvent:t}),this._currentDropZone=n,this.emit("dragenter",{position:{x:t.clientX,y:t.clientY},dropZone:n,originalEvent:t})))};this._onDragOver=t=>{if(!this._hasFiles(t))return;let n=this._findDropZone(t);n&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),this.emit("dragover",{position:{x:t.clientX,y:t.clientY},dropZone:n,originalEvent:t}))};this._onDragLeave=t=>{this._hasFiles(t)&&(this._dragCount--,this._dragCount===0&&this._currentDropZone&&(this.emit("dragleave",{position:{x:t.clientX,y:t.clientY},dropZone:this._currentDropZone,originalEvent:t}),this._currentDropZone=null))};this._onDrop=t=>{t.preventDefault(),this._dragCount=0;let n=this._findDropZone(t);if(!n)return;let i=this._getFiles(t);i.length!==0&&(this.emit("drop",{files:i,position:{x:t.clientX,y:t.clientY},dropZone:n,originalEvent:t}),this._currentDropZone=null)};this._container=t.container,this._options=t}attach(){if(this._attached)return;let t=this._getEventTarget();t.addEventListener("dragenter",this._onDragEnter,{passive:!1}),t.addEventListener("dragover",this._onDragOver,{passive:!1}),t.addEventListener("dragleave",this._onDragLeave,{passive:!1}),t.addEventListener("drop",this._onDrop,{passive:!1}),this._attached=!0}detach(){if(!this._attached)return;let t=this._getEventTarget();t.removeEventListener("dragenter",this._onDragEnter),t.removeEventListener("dragover",this._onDragOver),t.removeEventListener("dragleave",this._onDragLeave),t.removeEventListener("drop",this._onDrop),this._dragCount=0,this._currentDropZone=null,this._attached=!1}_getEventTarget(){return this._container instanceof ShadowRoot?this._container.host:this._container}_findDropZone(t){let n=t.target,i=t.composedPath();for(let o of i)if(o instanceof HTMLElement){if(o.matches(this._options.dropZoneSelector))return o;if(o===this._container||o===this._container.host)break}return n.closest?.(this._options.dropZoneSelector)}_hasFiles(t){if(!t.dataTransfer)return!1;let n=t.dataTransfer.types;return n.includes("Files")||n.includes("application/x-moz-file")}_getFiles(t){if(!t.dataTransfer?.files)return[];let n=Array.from(t.dataTransfer.files),i=this._options.accept;i&&i.length>0&&(n=n.filter(s=>this._matchesAccept(s,i)));let o=this._options.maxSize;return o&&o>0&&(n=n.filter(s=>s.size<=o)),!this._options.multiple&&n.length>1&&(n=[n[0]]),n}_matchesAccept(t,n){for(let i of n){if(i.startsWith(".")){if(t.name.toLowerCase().endsWith(i.toLowerCase()))return!0;continue}if(i.endsWith("/*")){let o=i.slice(0,-1);if(t.type.startsWith(o))return!0;continue}if(t.type===i)return!0}return!1}destroy(){this.detach(),super.destroy()}};var U={multiple:!0},A=class{constructor(e={}){this.name="file-drop";this._snap=null;this._sensor=null;this._onFileDrop=null;this._options={...U,...e}}init(e){this._snap=e;let t=this._getContainer();t&&(this._sensor=new T({container:t,dropZoneSelector:e.options.dropZoneSelector??"[data-file-drop]",accept:this._options.accept,multiple:this._options.multiple,maxSize:this._options.maxSize}),this._setupEventHandlers(),this._sensor.attach())}destroy(){this._sensor?.destroy(),this._sensor=null,this._snap=null,this._onFileDrop=null}onFileDrop(e){return this._onFileDrop=e,this}setOptions(e){Object.assign(this._options,e)}_getContainer(){return this._snap?this._snap._container:null}_setupEventHandlers(){this._sensor&&(this._sensor.on("dragenter",e=>{e.dropZone.classList.add("snap-file-drag-over")}),this._sensor.on("dragleave",e=>{e.dropZone.classList.remove("snap-file-drag-over")}),this._sensor.on("drop",e=>{e.dropZone.classList.remove("snap-file-drag-over");let t={files:e.files,position:e.position,dropZone:e.dropZone};this._onFileDrop?.(t),this._snap?.options?.onFileDrop?.(t)}))}};function W(r,e){let{onDrop:t,onDragEnter:n,onDragLeave:i,...o}=e,s=0,a=d=>{O(d)&&(d.preventDefault(),s++,s===1&&(r.classList.add("snap-file-drag-over"),n?.()))},l=d=>{O(d)&&(d.preventDefault(),d.dataTransfer&&(d.dataTransfer.dropEffect="copy"))},p=d=>{O(d)&&(s--,s===0&&(r.classList.remove("snap-file-drag-over"),i?.()))},u=d=>{d.preventDefault(),s=0,r.classList.remove("snap-file-drag-over");let c=Array.from(d.dataTransfer?.files??[]);o.accept?.length&&(c=c.filter(f=>N(f,o.accept))),o.maxSize&&(c=c.filter(f=>f.size<=o.maxSize)),!o.multiple&&c.length>1&&(c=[c[0]]),c.length>0&&t(c)};return r.addEventListener("dragenter",a),r.addEventListener("dragover",l),r.addEventListener("dragleave",p),r.addEventListener("drop",u),()=>{r.removeEventListener("dragenter",a),r.removeEventListener("dragover",l),r.removeEventListener("dragleave",p),r.removeEventListener("drop",u),r.classList.remove("snap-file-drag-over")}}function O(r){if(!r.dataTransfer)return!1;let e=r.dataTransfer.types;return e.includes("Files")||e.includes("application/x-moz-file")}function N(r,e){for(let t of e){if(t.startsWith(".")){if(r.name.toLowerCase().endsWith(t.toLowerCase()))return!0;continue}if(t.endsWith("/*")){let n=t.slice(0,-1);if(r.type.startsWith(n))return!0;continue}if(r.type===t)return!0}return!1}var V={threshold:40,maxSpeed:15,acceleration:2},R=class{constructor(e={}){this.name="auto-scroll";this._scrollableAncestors=[];this._rafId=null;this._active=!1;this._options={...V,...e}}onDragStart(e){this._scrollableAncestors=this._findScrollableAncestors(e.element),this._active=!0}onDragMove(e){!this._active||this._rafId!==null||(this._rafId=requestAnimationFrame(()=>{this._rafId=null,this._performScroll(e.current.x,e.current.y)}))}onDragEnd(){this._active=!1,this._scrollableAncestors=[],this._rafId!==null&&(cancelAnimationFrame(this._rafId),this._rafId=null)}destroy(){this.onDragEnd()}_performScroll(e,t){for(let n of this._scrollableAncestors){let i=n.getBoundingClientRect(),o=this._calculateScrollSpeed(e,t,i);(o.x!==0||o.y!==0)&&n.scrollBy({left:o.x,top:o.y,behavior:"instant"})}}_calculateScrollSpeed(e,t,n){let{threshold:i,maxSpeed:o}=this._options,s=0,a=0;return e<n.left+i?s=-this._getSpeed(n.left+i-e):e>n.right-i&&(s=this._getSpeed(e-(n.right-i))),t<n.top+i?a=-this._getSpeed(n.top+i-t):t>n.bottom-i&&(a=this._getSpeed(t-(n.bottom-i))),{x:s,y:a}}_getSpeed(e){let{threshold:t,maxSpeed:n,acceleration:i}=this._options,o=Math.min(e/t,1);return Math.pow(o,i)*n}_findScrollableAncestors(e){let t=[],n=e.parentElement;for(;n&&n!==document.body;){let i=getComputedStyle(n),o=i.overflowX,s=i.overflowY,a=(o==="auto"||o==="scroll")&&n.scrollWidth>n.clientWidth,l=(s==="auto"||s==="scroll")&&n.scrollHeight>n.clientHeight;(a||l)&&t.push(n),n=n.parentElement}return(document.documentElement.scrollHeight>window.innerHeight||document.documentElement.scrollWidth>window.innerWidth)&&t.push(document.documentElement),t}};var k=class{constructor(e){this.name="snap-grid";this._guideContainer=null;this._options=e}onDragStart(e){this._options.showGuides&&this._createGuides(e.element)}onDragMove(e){}onDragEnd(){this._removeGuides()}destroy(){this._removeGuides()}snap(e,t){return{x:Math.round(e/this._options.x)*this._options.x,y:Math.round(t/this._options.y)*this._options.y}}snapWithThreshold(e,t,n){let i=n??this._options.threshold??5,o=this.snap(e,t);return{x:Math.abs(e-o.x)<i?o.x:e,y:Math.abs(t-o.y)<i?o.y:t}}_createGuides(e){let t=e.offsetParent||document.body,n=t.getBoundingClientRect();this._guideContainer=document.createElement("div"),this._guideContainer.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 9998;
    `;let i=Math.ceil(n.width/this._options.x);for(let s=1;s<i;s++){let a=document.createElement("div");a.style.cssText=`
        position: absolute;
        left: ${s*this._options.x}px;
        top: 0;
        bottom: 0;
        width: 1px;
        background: rgba(0, 120, 255, 0.2);
      `,this._guideContainer.appendChild(a)}let o=Math.ceil(n.height/this._options.y);for(let s=1;s<o;s++){let a=document.createElement("div");a.style.cssText=`
        position: absolute;
        top: ${s*this._options.y}px;
        left: 0;
        right: 0;
        height: 1px;
        background: rgba(0, 120, 255, 0.2);
      `,this._guideContainer.appendChild(a)}t.appendChild(this._guideContainer)}_removeGuides(){this._guideContainer?.remove(),this._guideContainer=null}};var F=class{constructor(e={}){this.name="constraint-axis";this._bounds=null;this._options=e}onDragStart(e){this._options.containWithinParent?this._calculateParentBounds(e.element):this._options.bounds&&(this._bounds={minX:this._options.bounds.minX??-1/0,maxX:this._options.bounds.maxX??1/0,minY:this._options.bounds.minY??-1/0,maxY:this._options.bounds.maxY??1/0})}onDragMove(e){}onDragEnd(){this._bounds=null}destroy(){this._bounds=null}constrain(e,t){let{x:n,y:i}=e,o=this._options.axis??"both";return o==="x"?i=t.y:o==="y"&&(n=t.x),this._bounds&&(n=Math.max(this._bounds.minX,Math.min(this._bounds.maxX,n)),i=Math.max(this._bounds.minY,Math.min(this._bounds.maxY,i))),{x:n,y:i}}getBounds(){return this._bounds}_calculateParentBounds(e){let t=e.parentElement;if(!t)return;let n=t.getBoundingClientRect(),i=e.getBoundingClientRect();this._bounds={minX:n.left,maxX:n.right-i.width,minY:n.top,maxY:n.bottom-i.height}}};export{R as AutoScroll,P as BoundsCache,F as ConstraintAxis,S as DragEngine,b as DragState,H as DropZone,M as DropZoneManager,_ as EventEmitter,A as FileDrop,T as FileSensor,Z as Kanban,x as ObjectPool,y as PointerSensor,D as RAFThrottle,I as Snap,E as SnapDataTransfer,k as SnapGrid,w as Sortable,h as boundsCache,W as createFileDropZone,Y as default,v as pointPool,K as rafThrottle,$ as rectPool};
